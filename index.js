(()=>{"use strict";async function t(t){let e;e=t||await async function(){const t=await fetch("https://get.geojs.io/v1/ip/geo.json");return(await t.json()).city}();const n=await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${encodeURIComponent(e)}&units=metric&appid=8a6f11e64b821c66b1e532741f83e712`),a=await n.json(),o=a.weather[0].icon;return[e,Math.floor(a.main.temp),o,[a.coord.lat,a.coord.lon]]}async function e(e,n,a){const o=await t(e),[c,i,s,r]=o,l=a;l.querySelector(".tempInfo").innerText=i,l.querySelector(".weatherIcon").src=`https://openweathermap.org/img/wn/${s}.png`,l.querySelector(".userCity").innerHTML=c,function(t,e){const n=e,[a,o]=t;n.setView([a,o],10)}(r,n)}!async function(n){const a=document.querySelector("#app"),o=document.createElement("div");o.className="weatherBlock",a.append(o);const c=document.createElement("div");c.className="inputBlock";const i=document.createElement("div");i.className="historyBlock",localStorage.getItem("cities")||setTimeout((()=>{localStorage.setItem("cities","[]")}),0);const s=await t(),r=function(t,e){const n=t,[a,o]=e,c=document.createElement("div");c.id="mapid",c.style.height="180px",c.style.width="360px",n.append(c);const i=L.map(c);return i.setView([a,o],10),L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a>'}).addTo(i),i}(a,s[3]);a.append(c),a.append(i),function(t,e){const[n,a,o]=e;t.innerHTML=`\n\t<h2>Вы сейчас смотрите погоду для города - \n\t<span class='userCity'>${n}</span></h2>\n\t<p>Температура на улице: </p>\n\t<p><img class='weatherIcon' src='https://openweathermap.org/img/wn/${o}.png' />\n\t<span class='tempInfo'>${a}</span>°</p>\n\t`}(o,s),function(t,n,a,o){const c=t,i=n,s=o;c.innerHTML="\n\t\t<input class='cityInput' placeholder='Введите город' />\n\t\t<button class='submitCity'>Узнать погоду</button>\n\t",i.innerHTML="\n\t\t<h3>Просмотренные города/районы</h3>\n\t\t<button class='clearHistoryStorage'>Очистить локальное хранилище</button>\n\t\t<div class='viewedCitiesList'></div>\n\t",i.querySelector(".clearHistoryStorage").addEventListener("click",(()=>{setTimeout((()=>{localStorage.clear()}),0)})),function(t,n,a,o,c){const i=t,s=o,r=c;a.addEventListener("click",(async()=>{if(i.value||window.alert("Введите город"),i.value&&!r.querySelector(`.${i.value}`)){const t=r.querySelector(".viewedCitiesList"),a=i.value;try{await e(a,n,s);const o=document.createElement("p");o.className=a,o.textContent=a,t.append(o);let c=JSON.parse(localStorage.getItem("cities"));c.push(a),c.length>10&&(c=c.slice(1),setTimeout((()=>{localStorage.removeItem(r.querySelector(".viewedCitiesList").childNodes[0].innerText)}),0),t.removeChild(t.childNodes[0]));const i=JSON.stringify(c);setTimeout((()=>{localStorage.setItem("cities",i)}),0)}catch{window.alert(`Города ${a} не существует`)}}i.value=""}))}(c.querySelector(".cityInput"),a,c.querySelector(".submitCity"),s,i)}(c,i,r,o),i.addEventListener("click",(async t=>{const n=t.target;"P"===n.tagName&&await e(n.innerText,r,o)})),JSON.parse(localStorage.getItem("cities")).length>0&&function(t){const e=t;JSON.parse(localStorage.getItem("cities")).forEach((t=>{const n=e.querySelector(".viewedCitiesList"),a=t,o=document.createElement("p");o.className=a,o.textContent=a,n.append(o)}))}(a)}()})();